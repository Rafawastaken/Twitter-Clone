{% extends 'base.html' %}

<!-- Title -->
{% block page_title %} Welcome to Twitter 2 {% endblock %}

<!-- Content -->
{% block content %}
<div class="row text-center">
  <div class="col my-3">
    <div class="mt-3 h1">Welcome to Tweet Me!</div>
  </div>
</div>

<div class="row" id="tweets">Loading...</div>

<script>
  // Function to handle Likes
  function handleDidLike(tweetId, currentCount) {
    currentCount = currentCount + 1;
    return;
  }

  // Like button
  function likeButton(tweet) {
    var buttonHtml = `
    <button class="btn btn-primary btn-sm me-2" onclick="handleDidLike(${tweet.id}, ${tweet.likes})">
      ${tweet.likes} Likes
    </button>`;
    return buttonHtml;
  }

  // Function to format raw data into tweets
  function formatTweetElement(tweet) {
    formatedTweet = `
    <div class="col-12 col-md-10 mx-auto mb-3 border rounded py-3" id='tweet-${
      tweet.id
    }'>
        <p> 
            ${tweet.content}
        </p> 
        <div class='btn-group'>
            ${likeButton(tweet)}
        </div>
    </div>`;
    return formatedTweet;
  }

  // DOM Tweet elment
  const tweetElement = document.getElementById("tweets");

  // Request tweets
  const xhr = new XMLHttpRequest();
  const method = "GET";
  const url = "/tweets";
  const responseType = "json";

  xhr.responseType = responseType;
  xhr.open(method, url);

  xhr.onload = () => {
    const serverResponse = xhr.response;
    var listedItems = serverResponse.response;
    var finalTweetStr = "";

    // Iterate tweets and append
    for (let i = 0; i < listedItems.length; i++) {
      currentTweet = formatTweetElement(listedItems[i]);
      finalTweetStr = finalTweetStr + currentTweet;
    }

    // Update DOM
    tweetElement.innerHTML = finalTweetStr;
  };

  xhr.send();
</script>

{% endblock %}
