{% extends 'base.html' %}

<!-- Title -->
{% block page_title %} Welcome to Twitter 2 {% endblock %}

<!-- Content -->
{% block content %}
<div class="container">
  <div class="mt-3 display-4">Welcome to Twitter 2!</div>

  <div id="tweets">Loading...</div>
</div>

<script>
  // Function to handle Likes
  function handleDidLike(tweetId, currentCount) {
    return;
  }

  // Like button
  function likeButton(tweet) {
    var buttonHtml = `
    <button class="btn btn-primary btn-sm me-2" onclick="handleDidLike(${tweet.id}, ${tweet.likes})">
        Like
    </button> 
    <p class="text-muted m-0">
        ${tweet.likes}üëç
    </p>`;
    return buttonHtml;
  }

  // Function to format raw data into tweets
  function formatTweetElement(tweet) {
    formatedTweet = `
    <div class="mb-3 border" id='tweet-${tweet.id}'>
        <p> 
            ${tweet.content}
        </p> 
        <div class='btn-group'>
            ${likeButton(tweet)}
        </div>
    </div>`;
    return formatedTweet;
  }

  // DOM Tweet elment
  const tweetElement = document.getElementById("tweets");

  // Request tweets
  const xhr = new XMLHttpRequest();
  const method = "GET";
  const url = "/tweets";
  const responseType = "json";

  xhr.responseType = responseType;
  xhr.open(method, url);

  xhr.onload = () => {
    const serverResponse = xhr.response;
    var listedItems = serverResponse.response;
    var finalTweetStr = "";

    // Iterate tweets and append
    for (let i = 0; i < listedItems.length; i++) {
      currentTweet = formatTweetElement(listedItems[i]);
      finalTweetStr = finalTweetStr + currentTweet;
    }

    // Update DOM
    tweetElement.innerHTML = finalTweetStr;
  };

  xhr.send();
</script>

{% endblock %}
